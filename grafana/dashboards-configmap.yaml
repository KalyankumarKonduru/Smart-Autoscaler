apiVersion: v1
kind: ConfigMap
metadata:
  name: autoscaler-dashboard
  namespace: smart-autoscaler
  labels:
    grafana_dashboard: "1"
data:
  autoscaler.json: |
    {
      "title": "Smart Autoscaler",
      "schemaVersion": 39,
      "panels": [
        { "type": "graph", "title": "CPU per pod (sample-app)", "targets": [
          { "expr": "rate(process_cpu_seconds_total{job=\"sample-app\"}[1m])" }
        ]},
        { "type": "graph", "title": "Request P95 (ms)", "targets": [
          { "expr": "histogram_quantile(0.95, sum(rate(http_request_duration_ms_bucket{job=\"sample-app\",route=\"/work\"}[1m])) by (le))" }
        ]}
      ]
    }
